<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Board</title>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <link rel="stylesheet" href="/css/edit.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.48.4/codemirror.min.css"
    />
  </head>
  <body>
    <div class="container">
      <h2>내 정보 수정</h2>
      <form
        action="/profile/update"
        method="POST"
        enctype="multipart/form-data"
      >
        <!-- 프로필 이미지 -->
        <div class="profile-img">
          <img id="preview" src="<%= user.imageurl %>" alt="프로필 사진" />
          <input
            type="file"
            name="profileImage"
            id="profileImage"
            accept="image/*"
          />
        </div>

        <!-- 이메일 (수정 불가) -->
        <label>이메일</label>
        <input type="email" name="email" value="<%= user.email %>" readonly />

        <!-- 이름 -->
        <label>이름</label>
        <input type="text" name="name" value="<%= user.name %>" required />

        <!-- 전화번호 -->
        <label>전화번호</label>
        <input type="text" name="phone" value="<%= user.phone %>" required />

        <!-- 주소 -->
        <label>주소</label>
        <input type="text" name="address" value="<%= user.address || '' %>" />

        <!-- 비밀번호 변경 -->
        <label>새 비밀번호</label>
        <input type="password" name="password" placeholder="새 비밀번호 입력" />

        <!-- 생년월일 -->
        <label>생년월일</label>
        <input
          type="date"
          name="birth_date"
          value="<%= user.birth_date %>"
          required
        />

        <!-- 버튼들 -->
        <div class="button-group">
          <button type="button" onclick="location.href='/my-posts'">
            내 게시물 보기
          </button>
          <button type="submit">수정 완료</button>
          <button type="button" onclick="location.href='/logout'">
            로그아웃
          </button>
          <button type="button" class="delete-btn" onclick="confirmDelete()">
            회원 탈퇴
          </button>
        </div>
      </form>
    </div>

    <script>
      // 프로필 이미지 미리보기 기능
      document
        .getElementById("profileImage")
        .addEventListener("change", function (event) {
          const file = event.target.files[0];
          if (file) {
            const reader = new FileReader();
            reader.onload = function (e) {
              document.getElementById("preview").src = e.target.result;
            };
            reader.readAsDataURL(file);
          }
        });

      // 회원 탈퇴 확인
      function confirmDelete() {
        if (confirm("정말 회원 탈퇴하시겠습니까?")) {
          location.href = "/profile/delete";
        }
      }
    </script>
    <script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
    <script src="https://uicdn.toast.com/editor/latest/toastui-editor-all.min.js"></script>
    <script src="/js/edit.js"></script>
  </body>
</html>
