function toggleCustomDomain() {
  const selectBox = document.getElementById("emailDomainSelect");
  const customDomainInput = document.getElementById("customDomain");

  if (selectBox.value === "ÏßÅÏ†ëÏûÖÎ†•") {
    customDomainInput.disabled = false;
    customDomainInput.focus();
  } else {
    customDomainInput.disabled = true;
    customDomainInput.value = "";
  }
}

// ÎπÑÎ∞ÄÎ≤àÌò∏ Î≥¥Í∏∞/Ïà®Í∏∞Í∏∞ Í∏∞Îä•
function togglePassword(inputId, iconId) {
  const input = document.getElementById(inputId);
  const icon = document.getElementById(iconId);

  if (input.type === "password") {
    input.type = "text";
    icon.textContent = "üôà";
  } else {
    input.type = "password";
    icon.textContent = "üëÅÔ∏è";
  }
}

// Ïπ¥Ïπ¥Ïò§ ÏßÄÎèÑ api
function sample6_execDaumPostcode() {
  new daum.Postcode({
    oncomplete: function (data) {
      var addr = "";
      var extraAddr = "";

      if (data.userSelectedType === "R") {
        addr = data.roadAddress;
      } else {
        addr = data.jibunAddress;
      }

      if (data.userSelectedType === "R") {
        if (data.bname !== "" && /[Îèô|Î°ú|Í∞Ä]$/g.test(data.bname)) {
          extraAddr += data.bname;
        }

        if (data.buildingName !== "" && data.apartment === "Y") {
          extraAddr +=
            extraAddr !== "" ? ", " + data.buildingName : data.buildingName;
        }

        if (extraAddr !== "") {
          extraAddr = " (" + extraAddr + ")";
        }

        document.getElementById("sample6_extraAddress").value = extraAddr;
      } else {
        document.getElementById("sample6_extraAddress").value = "";
      }

      document.getElementById("sample6_postcode").value = data.zonecode;
      document.getElementById("sample6_address").value = addr;
      document.getElementById("sample6_detailAddress").focus();
    },
  }).open();
}

// ÏÉùÎÖÑÏõîÏùº select
document.addEventListener("DOMContentLoaded", function () {
  const yearSelect = document.getElementById("birthYear");
  const monthSelect = document.getElementById("birthMonth");
  const daySelect = document.getElementById("birthDay");

  const currentYear = new Date().getFullYear();

  for (let i = currentYear; i >= 1900; i--) {
    let option = document.createElement("option");
    option.value = i;
    option.textContent = i;
    yearSelect.appendChild(option);
  }

  for (let i = 1; i <= 12; i++) {
    let option = document.createElement("option");
    option.value = i;
    option.textContent = i;
    monthSelect.appendChild(option);
  }

  function updateDays() {
    daySelect.innerHTML = '<option value="" disabled selected>Ïùº</option>'; // Ï¥àÍ∏∞Ìôî
    let selectedYear = parseInt(yearSelect.value);
    let selectedMonth = parseInt(monthSelect.value);
    if (!selectedYear || !selectedMonth) return;

    let daysInMonth = new Date(selectedYear, selectedMonth, 0).getDate();
    for (let i = 1; i <= daysInMonth; i++) {
      let option = document.createElement("option");
      option.value = i;
      option.textContent = i;
      daySelect.appendChild(option);
    }
  }

  // ÏõîÏù¥ Î≥ÄÍ≤ΩÎê† ÎïåÎßàÎã§ Ïùº Ïàò ÏóÖÎç∞Ïù¥Ìä∏
  yearSelect.addEventListener("change", updateDays);
  monthSelect.addEventListener("change", updateDays);
});

// Ïà´Ïûê input
document.addEventListener("DOMContentLoaded", function () {
  const phoneMiddle = document.getElementById("phoneMiddle");
  const phoneLast = document.getElementById("phoneLast");

  function allowOnlyNumbers(event) {
    this.value = this.value.replace(/[^0-9]/g, "");
  }

  phoneMiddle.addEventListener("input", allowOnlyNumbers);
  phoneLast.addEventListener("input", allowOnlyNumbers);
});

// Ïú†Ìö®ÏÑ± Í≤ÄÏÇ¨
let emailCheck = false;
let passwordCheck = false;
let confirmPasswordCheck = false;

// Ïù¥Î©îÏùº Ïú†Ìö®ÏÑ± Í≤ÄÏÇ¨
const emailOninput = () => {
  const emailInput = document.querySelector("#email");
  const customDomainInput = document.querySelector("#customDomain");
  const emailDomainSelect = document.querySelector("#emailDomainSelect");
  const emailText = document.querySelector(".emailText");

  const emailInputText = emailInput.value.trim();
  const customDomainText = customDomainInput.value.trim();
  const selectedDomain = emailDomainSelect.value;

  let fullEmail = emailInputText;
  if (selectedDomain === "ÏßÅÏ†ëÏûÖÎ†•") {
    fullEmail += "@" + customDomainText;
  } else {
    fullEmail += "@" + selectedDomain;
  }

  const strictEmailRegex =
    /^(?!.*\.\.)[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;

  // Ïù¥Î©îÏùºÏù¥ ÎπÑÏñ¥ÏûàÍ±∞ÎÇò, ÎèÑÎ©îÏù∏Ïù¥ ÎπÑÏñ¥ÏûàÏúºÎ©¥
  if (emailInputText.length < 1) {
    emailText.innerText = "ÏïÑÏù¥ÎîîÎ•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî.";
    emailText.style.color = "red";
    emailCheck = false;
  } else if (selectedDomain === "ÏßÅÏ†ëÏûÖÎ†•" && customDomainText.length < 1) {
    emailText.innerText = "ÎèÑÎ©îÏù∏ÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî.";
    emailText.style.color = "red";
    emailCheck = false;
  }
  // Ïù¥Î©îÏùº ÌòïÏãùÏù¥ ÎßûÏßÄ ÏïäÏúºÎ©¥
  else if (!strictEmailRegex.test(fullEmail)) {
    emailText.innerText = "Ïù¥Î©îÏùº ÌòïÏãùÏúºÎ°ú ÏûÖÎ†•ÌïòÏÑ∏Ïöî.";
    emailText.style.color = "red";
    emailCheck = false;
  } else {
    emailText.innerText = ""; // Î©îÏãúÏßÄ Ï†úÍ±∞
    emailCheck = true;
  }
  validCheck();
};
// ÎπÑÎ∞ÄÎ≤àÌò∏ Í≤ÄÏÇ¨
const passwordOninput = () => {
  const passwordInput = document.querySelector("#password");
  const passwordText = document.querySelector(".passwordText");

  const passwordTextValue = passwordInput.value.trim();
  const passwordRegex =
    /^(?=.*[a-zA-Z])(?=.*\d)(?=.*[!@#$%^&*(),.?":{}|<>])[a-zA-Z\d!@#$%^&*(),.?":{}|<>]{8,}$/;

  if (passwordTextValue.length < 1) {
    passwordText.innerText = "ÎπÑÎ∞ÄÎ≤àÌò∏Î•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî.";
    passwordText.style.color = "red";
    passwordCheck = false;
  } else if (!passwordRegex.test(passwordTextValue)) {
    passwordText.innerText =
      "ÏòÅÎ¨∏, Ïà´Ïûê, ÌäπÏàòÎ¨∏ÏûêÎ•º Ìè¨Ìï®ÌïòÏó¨ 8Ïûê Ïù¥ÏÉÅ ÏûëÏÑ±Ìï¥Ï£ºÏÑ∏Ïöî.";
    passwordText.style.color = "red";
    passwordCheck = false;
  } else {
    passwordText.innerText = "";
    passwordCheck = true;
  }
  validCheck();
};

// ÎπÑÎ∞ÄÎ≤àÌò∏ ÌôïÏù∏
const confirmPasswordOninput = () => {
  const passwordInput = document.querySelector("#password");
  const confirmPasswordInput = document.querySelector("#confirmPassword");
  const confirmPasswordText = document.querySelector(".confirmPasswordText");

  const passwordValue = passwordInput.value.trim();
  const confirmPasswordValue = confirmPasswordInput.value.trim();

  if (confirmPasswordValue.length < 1) {
    confirmPasswordText.innerText = "ÎπÑÎ∞ÄÎ≤àÌò∏ ÌôïÏù∏ÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî.";
    confirmPasswordText.style.color = "red";
    confirmPasswordCheck = false;
  } else if (passwordValue !== confirmPasswordValue) {
    confirmPasswordText.innerText = "ÎπÑÎ∞ÄÎ≤àÌò∏Í∞Ä ÏùºÏπòÌïòÏßÄ ÏïäÏäµÎãàÎã§.";
    confirmPasswordText.style.color = "red";
    confirmPasswordCheck = false;
  } else {
    confirmPasswordText.innerText = "";
    confirmPasswordCheck = true;
  }
  validCheck();
};

// Ïù¥Î¶Ñ
const nameOninput = () => {
  const nameInput = document.querySelector("#name");
  const nameText = document.querySelector(".nameText");

  const nameInputText = nameInput.value.trim();

  if (nameInputText.length < 1) {
    nameText.innerText = "Ïù¥Î¶ÑÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî.";
    nameText.style.color = "red";
    nameCheck = false;
  } else {
    nameText.innerText = "";
    nameCheck = true;
  }
  validCheck();
};

// ÌöåÏõêÍ∞ÄÏûÖ Ï¥ù Ïú†Ìö®ÏÑ± Í≤ÄÏÇ¨
// let saveBtn = document.querySelector("#saveBtn");
// function validCheck() {
//   if (
//     emailCheck === true &&
//     idCheck === true &&
//     priceCheck === true &&
//     contentCheck === true &&
//     imageAdd === true &&
//     typecheck === true
//   ) {
//     saveBtn.disabled = false;
//   } else {
//     saveBtn.disabled = true;
//   }
// }

// input Ï¥àÍ∏∞Ìôî
// Ï¥àÍ∏∞Ìôî Ìï®Ïàò
// function resetForm() {
//   // ÌÖçÏä§Ìä∏ Ï¥àÍ∏∞Ìôî
//   document.querySelector(".nameText").innerText = "";
//   document.querySelector(".priceText").innerText = "";
//   document.querySelector(".contentText").innerText = "";
//   document.querySelector(".idText").innerText = "";
//   document.querySelector(".imageupText").innerText = "";
//   document.querySelector("#preview").src = "";
//   document.querySelector("#preview").style.display = "none";
//   document.getElementById("imgpreviewbox1").style.border = "none";
//   document.getElementById("imgpreviewbox2").style.border = "none";
//   document.querySelector(".typeText").innerText = "";

//   // Ï≤¥ÌÅ¨ Î≥ÄÏàò Ï¥àÍ∏∞Ìôî
//   nameCheck = false;
//   priceCheck = false;
//   contentCheck = false;
//   idCheck = false;
//   imageAdd = false;
//   typecheck = false;
//   firstidCheck = false;
// }

// ÌöåÏõêÍ∞ÄÏûÖ axios
document.querySelector(".signBtn").addEventListener("click", async function () {
  const userData = {
    name: document.getElementById("name").value,
    phone:
      document.getElementById("phonePrefix").value +
      "-" +
      document.getElementById("phoneMiddle").value +
      "-" +
      document.getElementById("phoneLast").value,
    email:
      document.getElementById("email").value +
      "@" +
      (document.getElementById("emailDomainSelect").value === "ÏßÅÏ†ëÏûÖÎ†•"
        ? document.getElementById("customDomain").value
        : document.getElementById("emailDomainSelect").value),
    password: document.getElementById("password").value,
    address: {
      postcode: document.getElementById("sample6_postcode").value,
      fullAddress: document.getElementById("sample6_address").value,
      detail: document.getElementById("sample6_detailAddress").value,
      extra: document.getElementById("sample6_extraAddress").value,
    },
    gender: document.querySelector('input[name="gender"]:checked')?.value,
    birth_date:
      document.getElementById("birthYear").value +
      "-" +
      document.getElementById("birthMonth").value +
      "-" +
      document.getElementById("birthDay").value,
    age:
      new Date().getFullYear() -
      parseInt(document.getElementById("birthYear").value, 10),
  };

  try {
    const response = await axios.post("/api/users/signup", userData);
    alert("ÌöåÏõêÍ∞ÄÏûÖ ÏÑ±Í≥µ!");
    console.log(response.data);
  } catch (error) {
    alert("ÌöåÏõêÍ∞ÄÏûÖ Ïã§Ìå®: " + (error.response?.data?.message || error.message));
    console.error(error);
  }
});

// axios - email Ï§ëÎ≥µ Í≤ÄÏÇ¨
const emailInput = document.querySelector("#email");
const customDomainInput = document.querySelector("#customDomain");
const emailDomainSelect = document.querySelector("#emailDomainSelect");
const emailCheckBtn = document.querySelector(".emailCheckBtn");
const emailText = document.querySelector(".emailText");

function getEmailAddress() {
  const email = emailInput.value.trim();
  const domain =
    emailDomainSelect.value === "ÏßÅÏ†ëÏûÖÎ†•"
      ? customDomainInput.value.trim()
      : emailDomainSelect.value;
  return `${email}@${domain}`;
}

emailCheckBtn.addEventListener("click", () => {
  const emailAddress = getEmailAddress();

  if (!emailAddress.includes("@") || emailAddress.split("@")[0] === "") {
    emailText.innerText = "Ïò¨Î∞îÎ•∏ Ïù¥Î©îÏùº ÌòïÏãùÏù¥ ÏïÑÎãôÎãàÎã§.";
    emailText.style.color = "red";
    return;
  }

  axios
    .post("/api/emailcheck", { email: emailAddress })
    .then((res) => {
      if (res.data.available) {
        emailText.innerText = "ÏÇ¨Ïö© Í∞ÄÎä•Ìïú Ïù¥Î©îÏùºÏûÖÎãàÎã§.";
        emailText.style.color = "green";
      } else {
        emailText.innerText =
          "Ï§ëÎ≥µÎêú Ïù¥Î©îÏùºÏûÖÎãàÎã§. Îã§Î•∏ Ïù¥Î©îÏùºÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.";
        emailText.style.color = "red";
      }
    })
    .catch((error) => {
      console.error("Ï§ëÎ≥µ ÌôïÏù∏ ÏóêÎü¨:", error);
      emailText.innerText = "ÏÑúÎ≤Ñ Ïò§Î•ò. Îã§Ïãú ÏãúÎèÑÌï¥Ï£ºÏÑ∏Ïöî.";
      emailText.style.color = "red";
    });
});
